<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Git Internals</title>
<meta name="author" content="(Aaron Kuehler)"/>

<link rel="stylesheet" href="../reveal.js/css/reveal.css"/>
<link rel="stylesheet" href="../reveal.js/css/theme/black.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1>Git Internals</h1>
<h2>Aaron Kuehler</h2>
<h2><a href="mailto:"></a></h2>
<h2></h2>
</section>

<section>
<section id="slide-sec-1">
<h2 id="sec-1">This talk is</h2>
<p>
a high level tour of git's internals
</p>


</section>
</section>
<section>
<section id="slide-sec-2">
<h2 id="sec-2">This talk isn't</h2>
<p>
a git tutorial
</p>


</section>
</section>
<section>
<section id="slide-sec-3">
<h2 id="sec-3">What is Git?</h2>


</section>
</section>
<section>
<section id="slide-sec-4">
<h2 id="sec-4">You might have heard&#x2026;</h2>
<blockquote nil>
<p>
Git (<i>ɡɪt</i>) is a distributed revision control system with an
emphasis on speed, data integrity, and support for distributed,
non-linear workflows and BLAH BLAH BLAH BLAH BLAH BLAH&#x2026;
</p>

<p>
&#x2013; Wikipedia
</p>
</blockquote>



</section>
</section>
<section>
<section id="slide-sec-5">
<h2 id="sec-5">Kinda, but really&#x2026;</h2>


</section>
</section>
<section>
<section id="slide-sec-6">
<h2 id="sec-6">Git is an inter-dimensional, time traveling spaceship</h2>

<div class="figure">
<p><img src="./images/tardis.png" alt="tardis.png" />
</p>
</div>


</section>
</section>
<section>
<section id="slide-sec-7">
<h2 id="sec-7">How the spaceship is built</h2>

</section>
</section>
<section>
<section id="slide-sec-8">
<h2 id="sec-8">Object Database</h2>
<ul>
<li>Contained within the <i>.git</i> directory</li>
<li>A key-value store (Hashes =&gt; Contents)</li>

</ul>

</section>
<section id="slide-sec-8-1">
<h3 id="sec-8-1">Hashing</h3>
<ul>
<li>INPUT: Any amount of data</li>
<li>OUTPUT: Fixed-size digest</li>

</ul>
<pre  class="example">
=&gt; echo "short thing to hash" | openssl dgst -sha1
199e4f3bcf4b1ea640949b11f44d1a48f4bacf6c

=&gt; echo "loooooooong thing to hash" | openssl dgst -sha1
a75402ee333f2f6d5937ff2be031b5945caa9c1b
</pre>

</section>
<section id="slide-sec-8-2">
<h3 id="sec-8-2">Identity</h3>
<ul>
<li>Git generates a hash for any piece of information it's told to save</li>
<li>Objects are identified <b>ONLY</b> by the hash of their contents</li>
<li>Hashes are unambiguous identifiers
<ul>
<li>By contrast, file system names and paths only tell you where; not what</li>

</ul></li>

</ul>

</section>
<section id="slide-sec-8-3">
<h3 id="sec-8-3">Integrity</h3>
<ul>
<li>Hashing makes it easy to detect bit-level storage errors</li>
<li>Hashing makes it difficult to falsify objects</li>

</ul>

</section>
<section id="slide-sec-8-4">
<h3 id="sec-8-4">Objects</h3>
<ul>
<li>Generic term for a <b>HASH =&gt; Contents</b> relationship</li>
<li>3 general types of objects&#x2026;</li>

</ul>

</section>
<section id="slide-sec-8-5">
<h3 id="sec-8-5">Blob Objects</h3>
<ul>
<li>Contents of a files</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">=&gt; ls
total 16
drwxr-xr-x   7 aaronk  staff   238B Jun 16 09:11 .
drwxr-xr-x   9 aaronk  staff   306B Jun 15 15:46 ..
drwxr-xr-x  16 aaronk  staff   544B Jun 16 09:11 .git
-rw-r--r--   1 aaronk  staff    86B Jun 15 16:10 .gitmodules
-rw-r--r--   1 aaronk  staff    54B Jun 16 09:10 README
drwxr-xr-x   6 aaronk  staff   204B Jun 16 09:07 git_internals
drwxr-xr-x  16 aaronk  staff   544B Jun 15 16:10 reveal.js
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-bash">=&gt; git hash-object README
59e1f9a827c70a7ab74c4ead6ed3d71be53ebb15
</pre>
</div>

</section>
<section id="slide-sec-8-6">
<h3 id="sec-8-6">Tree Objects</h3>
<ul>
<li>Akin to UNIX directory entries</li>
<li>Group blobs and other tree objects</li>
<li>Describes the file system mode, type, hash, and name of contents</li>
<li>Hashed by its metadata and its content's hashes</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">04000es0 tree 37575c28afe11142022728378a61290db6944b55 git_internals
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-bash">=&gt; git ls-tree 37575c28afe11142022728378a61290db6944b55
100644 blob b604cebcf51df85a482bb3fa512f4b35b779904e git_internals.html
100644 blob c26e176b07a6ca31ce24944f77724971b1f70036 git_internals.org
040000 tree 01130c2e51b2cff13d89fa3710d2746168c762f9 images
</pre>
</div>

</section>
<section id="slide-sec-8-7">
<h3 id="sec-8-7">Commit Objects</h3>
<ul>
<li>Identified by Hash of the root tree object</li>
<li>Records entire state of the repository at a point in time</li>
<li>Commit Meta-data
<ul>
<li>Author, subject and log message, when it was made</li>

</ul></li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git log --oneline -n 1
ef971ae add README
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-bash">=&gt; git ls-tree ef971ae
100644 blob b2a68171122dcbfdccdb9a9e824a567c6ef9fed2 .gitmodules
100644 blob 59e1f9a827c70a7ab74c4ead6ed3d71be53ebb15 README
040000 tree 37575c28afe11142022728378a61290db6944b55 git_internals
160000 commit f0cf1f54d04088d241acf81eef42bd878a9f02ba reveal.js
</pre>
</div>


</section>
</section>
<section>
<section id="slide-sec-9">
<h2 id="sec-9">How the spaceship moves</h2>
<div class="outline-text-2" id="text-9">
</div></section>
<section id="slide-sec-9-1">
<h3 id="sec-9-1">"Legacy" Version Control Systems</h3>

<div class="figure">
<p><img src="./images/deltas.png" alt="deltas.png" />
</p>
</div>
<ul>
<li>A list of changes to a collection of files</li>

</ul>

</section>
<section id="slide-sec-9-2">
<h3 id="sec-9-2">Git</h3>

<div class="figure">
<p><img src="./images/snapshots.png" alt="snapshots.png" />
</p>
</div>

<ul>
<li>A stream of snapshots of the repository's file system</li>
<li>If a file hasn't changed, a reference to the previous version is stored</li>

</ul>



</section>
</section>
<section>
<section id="slide-sec-10">
<h2 id="sec-10">Managing Changes</h2>
<ul>
<li>3 states of changes
<ul>
<li>Modified</li>
<li>Staged for commit</li>
<li>Committed</li>

</ul></li>

</ul>

</section>
<section id="slide-sec-10-1">
<h3 id="sec-10-1">Working Directory</h3>
<ul>
<li>Project root directory</li>
<li>Contents are at a single version state of the project</li>
<li>Files are pulled out of the git object database and put onto disk to be modified</li>
<li>Changes are introduced here</li>

</ul>

</section>
<section id="slide-sec-10-2">
<h3 id="sec-10-2">Index</h3>
<ul>
<li>Commit staging area</li>
<li>A file in the <b>.git</b> directory</li>
<li>Groups changes across repository contents as a logical change set</li>
<li>Add changes to the index with
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git add
</pre>
</div></li>

</ul>

</section>
<section id="slide-sec-10-3">
<h3 id="sec-10-3">Repository</h3>
<ul>
<li>Is the <b>.git</b> directory at the project root</li>
<li>Persistent, compressed object database</li>
<li>Changes become permanent residents of the repository through Commits
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git commit
</pre>
</div></li>

</ul>


</section>
</section>
<section>
<section id="slide-sec-11">
<h2 id="sec-11">History</h2>
<ul>
<li>A commit object knows the hash of the commit that came before it</li>
<li>It is easy to detect when history has been rewritten
<ul>
<li>Some parent commit's hash will fail hash validation</li>

</ul></li>

</ul>


</section>
</section>
<section>
<section id="slide-sec-12">
<h2 id="sec-12">Branches</h2>
<ul>
<li>Two or more commits share the same parent</li>
<li>Use to segregate and track unrelated change sets</li>
<li>Branches are CHEAP! (it's just a parent commit ref)</li>

</ul>

<div class="figure">
<p><img src="./images/branches.png" alt="branches.png" />
</p>
</div>


</section>
</section>
<section>
<section id="slide-sec-13">
<h2 id="sec-13">HEAD</h2>
<ul>
<li>Mapping of a <b>Name =&gt; Commit</b></li>
<li>Adding a commit on a branch reassigns the HEAD ref to the new commit</li>

</ul>

<div class="figure">
<p><img src="./images/heads.png" alt="heads.png" />
</p>
</div>


</section>
<section id="slide-sec-13-1">
<h3 id="sec-13-1">Spoiler Alert</h3>
<ul>
<li>All HEADs are created equal</li>
<li>Nothing special about the master or develop HEAD refs</li>
<li>It's just a naming convention</li>

</ul>


</section>
</section>
<section>
<section id="slide-sec-14">
<h2 id="sec-14">Changing the course of history</h2>
<ul>
<li>Commit E is a mistake and we want to remove it</li>

</ul>

<div class="figure">
<p><img src="./images/timetravel1.png" alt="timetravel1.png" />
</p>
</div>


</section>
<section id="slide-sec-14-1">
<h3 id="sec-14-1">Changing the course of history</h3>
<ul>
<li>Change the feature/xyz HEAD ref Commit D</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git reset HEAD~1
</pre>
</div>

<div class="figure">
<p><img src="./images/timetravel2.png" alt="timetravel2.png" />
</p>
</div>


</section>
<section id="slide-sec-14-2">
<h3 id="sec-14-2">Changing the course of history</h3>
<ul>
<li>Make a new commit</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git add -all
=&gt; git commit
</pre>
</div>

<div class="figure">
<p><img src="./images/timetravel3.png" alt="timetravel3.png" />
</p>
</div>


</section>
<section id="slide-sec-14-3">
<h3 id="sec-14-3">Changing the course of history</h3>
<ul>
<li>Unreachable commits are removed from the repository</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">=&gt; git gc
</pre>
</div>

<div class="figure">
<p><img src="./images/timetravel3.png" alt="timetravel3.png" />
</p>
</div>


</section>
</section>
<section>
<section id="slide-sec-15">
<h2 id="sec-15">Changing history itself</h2>
<ul>
<li>Rewrite a point in history to create a new version of reality</li>
<li>Called <b>Rebasing</b></li>

</ul>


</section>
<section id="slide-sec-15-1">
<h3 id="sec-15-1">Rebasing</h3>
<ul>
<li>What if we forgot to add something as part of commit B</li>

</ul>

<div class="figure">
<p><img src="./images/rebasing1.png" alt="rebasing1.png" />
</p>
</div>


</section>
<section id="slide-sec-15-2">
<h3 id="sec-15-2">Rebasing</h3>
<ul>
<li>Go back in time and make the commit you wish you had instead of commit B &#x2013; commit E</li>

</ul>

<div class="figure">
<p><img src="./images/rebasing2.png" alt="rebasing2.png" />
</p>
</div>


</section>
<section id="slide-sec-15-3">
<h3 id="sec-15-3">Rebasing</h3>
<ul>
<li>OK, now what?</li>
<li>Can't <b>just</b> move the feature/xyz HEAD</li>
<li>We'd lose commits C and D</li>

</ul>

<div class="figure">
<p><img src="./images/rebasing3.png" alt="rebasing3.png" />
</p>
</div>


</section>
<section id="slide-sec-15-4">
<h3 id="sec-15-4">Rebasing</h3>
<ul>
<li>"Replaying commits"</li>
<li>Git can calculate diffs between parent and child commits</li>
<li>Rebasing does this for all commits after B</li>
<li>Then applies the diffs as new commits on top of E</li>

</ul>

<div class="figure">
<p><img src="./images/rebasing4.png" alt="rebasing4.png" />
</p>
</div>


</section>
</section>
<section>
<section id="slide-sec-16">
<h2 id="sec-16">With great power&#x2026;</h2>
<ul>
<li>Changing shared history can be bad</li>
<li>Leaves fellow time travelers stuck in unreferenced, parallel dimensions</li>
<li>Never on rebase shared timelines (develop, master, release)</li>
<li>Usually safe with private timelines (feature, hotfix)</li>
<li>But, it can be really useful for keeping history "clean"</li>

</ul>


</section>
</section>
<section>
<section id="slide-sec-17">
<h2 id="sec-17">Summary</h2>
<ul>
<li>Nomenclature: Repository, Hash, Object, Head, Index, etc</li>
<li>How git tracks time and space internally</li>

</ul>


</section>
</section>
<section>
<section id="slide-sec-18">
<h2 id="sec-18">Sources / Resources</h2>
<ul>
<li>Slides (<a href="http://bit.ly/talks_git_internals">http://bit.ly/talks_git_internals</a>)</li>
<li>Pro Git (<a href="http://git-scm.com/book/en/v2">http://git-scm.com/book/en/v2</a>)</li>
<li>Git From the Bottom Up (<a href="http://ftp.newartisans.com/pub/git.from.bottom.up.pdf">http://ftp.newartisans.com/pub/git.from.bottom.up.pdf</a>)</li>
<li>Wikipedia (<a href="https://en.wikipedia.org/?title=Git_(software)">https://en.wikipedia.org/?title=Git_(software)</a>)</li>

</ul>
</section>
</section>
</div>
</div>

<script src="../reveal.js/lib/js/head.min.js"></script>
<script src="../reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: true,
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: '../reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: '../reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: '../reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: '../reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: '../reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: '../reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>
</body>
</html>
